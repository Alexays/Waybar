dist: xenial
os: linux
language: python
sudo: required

python: 3.6

addons:
    apt:
        sources:
            - ubuntu-toolchain-r-test
        packages:
            - gcc-7
            - g++-7
            - libinput10
            - libinput-dev
            - wayland-protocols

matrix:
    include:
        - env: CC=gcc-7 CXX=g++-7
        - env: CC=clang CXX=clang++

before_install:
    - git clone https://github.com/swaywm/wlroots subprojects/wlroots
    - wget http://http.us.debian.org/debian/pool/main/w/wayland/libwayland-client0_1.16.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/w/wayland/libwayland-cursor0_1.16.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/w/wayland/libwayland-bin_1.16.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/libg/libglvnd/libglvnd0_1.1.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/m/mesa/libegl-mesa0_18.1.9-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/libg/libglvnd/libegl1_1.1.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/m/mesa/libwayland-egl1-mesa_18.1.9-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/w/wayland/libwayland-egl1_1.16.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/w/wayland/libwayland-server0_1.16.0-1_amd64.deb
    - wget http://http.us.debian.org/debian/pool/main/w/wayland/libwayland-dev_1.16.0-1_amd64.deb
    - sudo dpkg -i libwayland-client0_1.16.0-1_amd64.deb libwayland-cursor0_1.16.0-1_amd64.deb libwayland-bin_1.16.0-1_amd64.deb libglvnd0_1.1.0-1_amd64.deb libegl-mesa0_18.1.9-1_amd64.deb libegl1_1.1.0-1_amd64.deb libwayland-egl1-mesa_18.1.9-1_amd64.deb libwayland-egl1_1.16.0-1_amd64.deb libwayland-server0_1.16.0-1_amd64.deb libwayland-dev_1.16.0-1_amd64.deb

install:
    - wget https://github.com/ninja-build/ninja/releases/download/v1.8.2/ninja-linux.zip
    - mkdir -p "$HOME/.local/bin"
    - unzip ninja-linux.zip -d ${HOME}/.local/bin
    - export PATH="$HOME/.local/bin:$PATH"
    - pip install meson

before_script:
    - mkdir build

script:
    - meson build
    - ninja -C build